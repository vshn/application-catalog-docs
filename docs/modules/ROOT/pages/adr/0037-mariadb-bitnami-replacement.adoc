= ADR 0037 - MariaDB Bitnami Replacement
:adr_author:    Nicolas Bigler
:adr_owner:     Schedar
:adr_reviewers:
:adr_date:      2025-07-30
:adr_upd_date:  2025-07-30
:adr_status:    draft
:adr_tags:      mariadb,bitnami,helm,service

include::partial$adr-meta.adoc[]

[NOTE]
.Summary
====
We are switching from the Bitnami MariaDB Helm Chart to the MariaDB Operator due to licensing cost changes and operational advantages.
====

== Problem

For our VSHNMariaDB offering, we have relied on the Bitnami Helm Chart.
However, the https://github.com/bitnami/containers/issues/83267[announced changes to the Bitnami catalog] force us to re-evaluate our options.
The new licensing model introduces significant costs for accessing versioned container images.

== Evaluated Options

[cols="2,1,1,1,1,1,2", options="header"]
|===
| Name | Type | Galera Support | Recovery Support | Active Project? | Metrics | Notes

| Bitnami Helm Chart
| Helm chart
| ✅
| ⚠️ Manual only
| ✅
| ✅ Sidecar per pod
| Very expensive, no automated recovery

| MariaDB Operator
| Operator
| ✅
| ✅ Fully automated
| ✅
| ✅ Dedicated + operator
| Official solution, active development, free

| Codership/Galera
| Helm chart
| ✅
| ⚠️ Manual only
| ❌
| ❌
| Designed for MySQL, limited docs, stale project
|===

== Comparison

=== MariaDB Operator

The *MariaDB Operator* is the official solution for managing MariaDB clusters, including *Galera* with **automated recovery** from cluster failures.
Developed and maintained by the MariaDB team, it is under *active development* with frequent updates.

*Key Features:*

- Simple upgrades by updating version tags
- Backup & restore Custom Resource Definitions (CRDs)
- Restore to existing instances or bootstrap new instances from backups
- Supported storage backends: PVC and S3
- Dedicated metrics deployment per MariaDB instance
- Operator provides its own metrics
- Proven compatibility with OpenShift

=== Bitnami Helm Chart

We have been using the Bitnami Helm Charts for MariaDB/Galera deployments.
They are well-tested, widely adopted, and generally reliable.

*Notable limitations:*

- *No automated recovery* - Requires manual intervention for cluster failures
- *No built-in backup/restore* - Must be implemented separately
- *Expensive access* - Version-specific image tags require costly subscription as of 2025-08-28

*Self-build attempt:*
We explored building our own images using Bitnami source components from `downloads.bitnami.com/files/stacksmith`:

- `ini-file` - Can be built from source
- `mariadb-galera` - Complex prebuilt component requiring significant reverse-engineering

The complexity and risk of reverse-engineering the `mariadb-galera` component make this approach unreliable.
While we achieved a successful build, no functional validation was performed, creating **high risk** of unexpected behavior.

== Decision

*We choose the MariaDB Operator* for the following reasons:

- Official MariaDB solution with guaranteed long-term support
- Active development with frequent releases
- Automated cluster recovery eliminates manual intervention
- Integrated backup and restore capabilities
- Open-source and free, eliminating licensing costs
- Proven OpenShift compatibility

== Consequences

With the decision to migrate from Bitnami to the MariaDB Operator, we need to:

* Refactor the MariaDB service in our Appcat and SPKS offerings
* Properly evaluate and implement a migration path for existing instances

This is a time-consuming effort, but justified given the high cost of Bitnami images.